<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardMapper">

<resultMap id="boardResultSet" type="board">
		<result column="BOARD_NO" property="boardNo" />
		<result column="BOARD_TITLE" property="boardTitle" />
		<result column="BOARD_DATE" property="boardDate" />
		<result column="BOARD_CONTENT" property="boardContent" />
		 <result column="MEMBER_ID" property="memberId" />
	</resultMap>

  <!-- 게시글 총 갯수 구하는 쿼리문 -->
  <select id="selectListCount" resultType="_int">
    SELECT COUNT(*)
    FROM QNA
    WHERE STATUS = 'Y'
  </select>

  <!-- 게시글 리스트를 구해주는 쿼리문 -->
  <select id="selectList" resultType="board" resultMap="boardResultSet">
  SELECT QNA.BOARD_NO
     , QNA.BOARD_TITLE
     , TO_CHAR(QNA.BOARD_DATE, 'YYYY-MM-DD') AS "BOARD_DATE"
     , MEMBER.MEMBER_ID
	FROM QNA
	INNER JOIN MEMBER ON QNA.MEMBER_ID = MEMBER.MEMBER_ID
	WHERE QNA.STATUS = 'Y'
	ORDER BY QNA.BOARD_NO DESC
  </select>

  <!--  게시글 작성용 쿼리문 -->
  <insert id="insertBoard" parameterType="board">
	  INSERT INTO QNA(BOARD_NO
	  , BOARD_TITLE
	  , BOARD_CONTENT
	  , MEMBER_ID)
	  VALUES(SEQ_BNO.NEXTVAL
	  , #{boardTitle}
	  , #{boardContent}
	  , NVL(#{memberId}, 0))
</insert>

<!--  게시글 삭제용 쿼리문 -->
<update id="deleteBoard" parameterType="_int">
	UPDATE QNA
		   SET STATUS = 'N'
		 WHERE BOARD_NO = #{boardNo}
</update>

<!--  게시글 수정용 쿼리문 -->
<update id="updateBoard" parameterType="board">
		UPDATE QNA
		   SET BOARD_TITLE = #{boardTitle}
		     , BOARD_CONTENT = #{boardContent}
		 WHERE BOARD_NO = #{boardNo}
	</update>

  <!-- 게시글 상세 조회용 쿼리문 -->
<select id="selectBoard" parameterType="_int" resultMap="boardResultSet">
    SELECT QNA.BOARD_NO
         , QNA.BOARD_TITLE
         , MEMBER.MEMBER_ID
         , TO_CHAR(QNA.BOARD_DATE, 'YYYY-MM-DD') AS "BOARD_DATE"
         , QNA.BOARD_CONTENT
      FROM QNA
      INNER JOIN MEMBER ON QNA.MEMBER_ID = MEMBER.MEMBER_ID
     WHERE QNA.BOARD_NO = #{boardNo} AND QNA.STATUS = 'Y'
</select>
<!-- 이전글 조회용 쿼리문 -->
<select id="selectPrevBoard" parameterType="_int" resultType="board">
    SELECT *
    FROM (
        SELECT QNA.BOARD_NO
             , QNA.BOARD_TITLE
             , MEMBER.MEMBER_ID
             , TO_CHAR(QNA.BOARD_DATE, 'YYYY-MM-DD') AS "BOARD_DATE"
             , QNA.BOARD_CONTENT
          FROM QNA
          INNER JOIN MEMBER ON QNA.MEMBER_ID = MEMBER.MEMBER_ID
         WHERE <![CDATA[ QNA.BOARD_NO < #{boardNo} ]]> AND QNA.STATUS = 'Y'
         ORDER BY QNA.BOARD_NO DESC
    ) WHERE ROWNUM = 1
</select>

<!-- 다음글 조회용 쿼리문 -->
<select id="selectNextBoard" parameterType="_int" resultType="board">
    SELECT *
    FROM (
        SELECT QNA.BOARD_NO
             , QNA.BOARD_TITLE
             , MEMBER.MEMBER_ID
             , TO_CHAR(QNA.BOARD_DATE, 'YYYY-MM-DD') AS "BOARD_DATE"
             , QNA.BOARD_CONTENT
          FROM QNA
          INNER JOIN MEMBER ON QNA.MEMBER_ID = MEMBER.MEMBER_ID
         WHERE QNA.BOARD_NO > #{boardNo} AND QNA.STATUS = 'Y'
         ORDER BY QNA.BOARD_NO ASC
    ) WHERE ROWNUM = 1
</select>


</mapper>

