<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org// Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.earthball.fo.payment.mapper.PaymentMapper">

<!-- 결제데이터 추가 -->
<insert id="payComplete" parameterType="com.kh.earthball.fo.payment.vo.PayInfo">
	INSERT INTO PAYMENT (PAYMENT_NO
									  , MEMBER_ID
									  , PAYMENT_DATE
									  , PAYMENT_TYPE
									  , STATUS
									  , PAYMENT_TOTAL
									  , RECEIVE_NAME
									  , RECEIVE_PHONE
									  , POST_CODE
									  , ADDRESS1
									  , ADDRESS2
									  , DELIVERY_COMMENT
									  , PAYMENT_TOKEN)
								VALUES (#{paymentNo}
									  , #{memberId}
									  , SYSDATE
									  , #{paymentType}
									  , 'Y'
									  , #{paymentTotal}
									  , #{receiveName}
									  , #{receivePhone}
									  , #{postCode}
									  , #{receiveAddress1}
									  , #{receiveAddress2}
									  , #{deliveryComment}
									  , #{paymentToken})
</insert>

<!-- 회원 주문누적금액 증가 -->
<update id="addTotalPay" parameterType="com.kh.earthball.fo.payment.vo.PayInfo">
	UPDATE MEMBER
	      SET TOTAL_PAY = TOTAL_PAY + #{paymentTotal}
	 WHERE MEMBER_ID = #{memberId}
</update>

<!-- 회원등급 새로고침 -->
<update id="updateGrade" parameterType="com.kh.earthball.fo.payment.vo.PayInfo">
	UPDATE MEMBER M
	      SET M.GRADE_NAME = (SELECT G.GRADE_NAME
	      										 FROM GRADE G
	      									   WHERE M.TOTAL_PAY BETWEEN G.PAYMENT_MIN AND G.PAYMENT_MAX)
	WHERE M.MEMBER_ID = #{memberId}
</update>

</mapper>